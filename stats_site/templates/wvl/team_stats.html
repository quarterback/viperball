{% extends "base.html" %}
{% block title %}Team Stats — {{ tier_name }} — WVL — Viperball Stats{% endblock %}

{% block breadcrumb %}
<div class="breadcrumb"><div class="container wide">
  <a href="/stats/">Home</a><span class="sep">/</span><a href="/stats/wvl/">WVL</a><span class="sep">/</span><a href="/stats/wvl/{{ session_id }}/">{{ dynasty_name }} ({{ year }})</a><span class="sep">/</span>Team Stats
</div></div>
{% endblock %}

{% block content %}
<div class="page-header">
  <h1>{{ tier_name }} &mdash; TEAM STATS</h1>
  <div class="subtitle">{{ dynasty_name }} &mdash; Year {{ year }}</div>
</div>

<div class="tabs">
  <a href="/stats/wvl/{{ session_id }}/">Standings</a>
  <a href="/stats/wvl/{{ session_id }}/schedule?tier={{ selected_tier }}">Schedule</a>
  <a href="/stats/wvl/{{ session_id }}/stats">Players</a>
  <a href="/stats/wvl/{{ session_id }}/team-stats" class="active">Team Stats</a>
</div>

{# Tier selector #}
<div style="margin-bottom:12px;font-size:11px;">
  <strong>Tier:</strong>
  {% for t in tier_list %}
  {% if t == selected_tier %}
  <span style="color:var(--accent);font-weight:bold">{{ tier_label(t) }}</span>
  {% else %}
  <a href="/stats/wvl/{{ session_id }}/team-stats?tier={{ t }}&sort={{ sort }}">{{ tier_label(t) }}</a>
  {% endif %}
  {% if not loop.last %} &middot; {% endif %}
  {% endfor %}
</div>

{# Sort selector #}
<div style="margin-bottom:16px; font-size:11px;">
  <strong>Sort by:</strong>
  {% for label, key in [
    ('Total Yards', 'total_yards'), ('Avg Yards', 'avg_yards'), ('YPP', 'yards_per_play'),
    ('TDs', 'touchdowns'), ('Rushing', 'rushing_yards'), ('Kick-Pass', 'kp_yards'),
    ('Laterals', 'lateral_yards'), ('EPA', 'epa'), ('EPA/G', 'avg_epa'),
    ('Rating', 'avg_team_rating'), ('Viper Eff', 'avg_viper_eff'),
    ('Delta Yds', 'delta_yards'), ('Bonus Poss', 'bonus_possessions'),
    ('Fumbles', 'fumbles'), ('Penalties', 'penalties'),
  ] %}
  {% if not loop.first %}&middot; {% endif %}
  <a href="/stats/wvl/{{ session_id }}/team-stats?tier={{ selected_tier }}&sort={{ key }}" {% if sort == key %}style="color:var(--accent);font-weight:bold"{% endif %}>{{ label }}</a>
  {% endfor %}
</div>

{% if teams %}
<div style="overflow-x:auto;">
<table>
  <thead>
    <tr>
      <th class="num">#</th>
      <th>Team</th>
      <th>W-L</th>
      <th class="num">GP</th>
      <th class="num">YDS</th>
      <th class="num">Y/G</th>
      <th class="num">YPP</th>
      <th class="num">TD</th>
      <th class="num">RUSH</th>
      <th class="num">KP</th>
      <th class="num">KP%</th>
      <th class="num">LAT</th>
      <th class="num">EPA</th>
      <th class="num">E/G</th>
      <th class="num">RTG</th>
      <th class="num">VE</th>
      <th class="num">&Delta;Y</th>
      <th class="num">FUM</th>
      <th class="num">PEN</th>
    </tr>
  </thead>
  <tbody>
  {% for t in teams %}
  <tr>
    <td class="num rank">{{ loop.index }}</td>
    <td><a href="/stats/wvl/{{ session_id }}/team/{{ t.team_key }}">{{ t.team }}</a></td>
    <td class="record"><span class="w">{{ t.get('wins', 0) }}</span>-<span class="l">{{ t.get('losses', 0) }}</span></td>
    <td class="num">{{ t.games }}</td>
    <td class="num {% if sort == 'total_yards' %}stat-good{% endif %}">{{ t.total_yards }}</td>
    <td class="num {% if sort == 'avg_yards' %}stat-good{% endif %}">{{ t.avg_yards }}</td>
    <td class="num {% if sort == 'yards_per_play' %}stat-good{% endif %}">{{ t.get('yards_per_play', 0) }}</td>
    <td class="num {% if sort == 'touchdowns' %}stat-good{% endif %}">{{ t.touchdowns }}</td>
    <td class="num {% if sort == 'rushing_yards' %}stat-good{% endif %}">{{ t.rushing_yards }}</td>
    <td class="num {% if sort == 'kp_yards' %}stat-good{% endif %}">{{ t.kp_yards }}</td>
    <td class="num">{{ t.get('kp_comp_pct', 0) }}%</td>
    <td class="num {% if sort == 'lateral_yards' %}stat-good{% endif %}">{{ t.lateral_yards }}</td>
    <td class="num {% if sort == 'epa' %}stat-good{% elif t.get('epa', 0) < 0 %}stat-bad{% endif %}">{{ '%.1f'|format(t.get('epa', 0)) }}</td>
    <td class="num {% if sort == 'avg_epa' %}stat-good{% elif t.get('avg_epa', 0) < 0 %}stat-bad{% endif %}">{{ t.get('avg_epa', 0) }}</td>
    <td class="num {% if sort == 'avg_team_rating' %}stat-good{% elif t.get('avg_team_rating', 0) >= 70 %}stat-elite{% elif t.get('avg_team_rating', 0) >= 55 %}stat-good{% endif %}">{{ t.get('avg_team_rating', 0) }}</td>
    <td class="num {% if sort == 'avg_viper_eff' %}stat-good{% endif %}">{{ t.get('avg_viper_eff', 0) }}</td>
    <td class="num {% if sort == 'delta_yards' %}stat-good{% elif t.get('delta_yards', 0) > 0 %}stat-good{% elif t.get('delta_yards', 0) < 0 %}stat-bad{% endif %}">{{ t.get('delta_yards', 0) }}</td>
    <td class="num {% if sort == 'fumbles' %}stat-good{% elif t.fumbles >= 5 %}stat-bad{% endif %}">{{ t.fumbles }}</td>
    <td class="num {% if sort == 'penalties' %}stat-good{% elif t.penalties >= 20 %}stat-bad{% endif %}">{{ t.penalties }}</td>
  </tr>
  {% endfor %}
  </tbody>
</table>
</div>
{% else %}
<p class="empty">No team stats available yet. Simulate some games first.</p>
{% endif %}

{% endblock %}
