{% extends "base.html" %}
{% block title %}World Cup — FIV — Viperball Stats{% endblock %}

{% block breadcrumb %}
<div class="breadcrumb"><div class="container wide">
  <a href="/stats/">Home</a><span class="sep">/</span><a href="/stats/international/">International</a><span class="sep">/</span>World Cup
</div></div>
{% endblock %}

{% block content %}
<div class="page-header">
  <h1>FIV WORLD CUP</h1>
  <div class="subtitle">
    {% if fiv_data %}Cycle {{ fiv_data.get('cycle_number', '?') }} &middot; Host: {{ fiv_data.get('host_nation', '?') }}{% endif %}
    {% if wc and wc.get('champion') %} &middot; <span class="stat-elite">Champion: {{ wc.champion }}</span>{% endif %}
  </div>
</div>

<div class="tabs">
  <a href="/stats/international/">Overview</a>
  <a href="/stats/international/rankings">Rankings</a>
  <a href="/stats/international/team-stats">Team Stats</a>
  <a href="/stats/international/worldcup" class="active">World Cup</a>
</div>

{% if wc %}

{# ── Groups ── #}
{% set groups = wc.get('groups', []) %}
{% if groups %}
<h2>Group Stage</h2>
<div class="grid-2">
{% for group in groups %}
<div>
<h3>{{ group.get('group_name', group.get('name', 'Group ' ~ loop.index)) }}</h3>
<table>
  <thead><tr><th class="num">#</th><th>Team</th><th class="num">P</th><th class="num">W</th><th class="num">D</th><th class="num">L</th><th class="num">PF</th><th class="num">PA</th><th class="num">Pts</th></tr></thead>
  <tbody>
  {% set standings = group.get('standings', group.get('table', [])) %}
  {% for t in standings %}
  <tr>
    <td class="num rank">{{ loop.index }}</td>
    <td><a href="/stats/international/team/{{ t.get('team', t.get('code', '?')) }}">{{ t.get('team', t.get('code', '?')) }}</a></td>
    <td class="num">{{ t.get('played', t.get('p', 0)) }}</td>
    <td class="num">{{ t.get('wins', t.get('w', 0)) }}</td>
    <td class="num">{{ t.get('draws', t.get('d', 0)) }}</td>
    <td class="num">{{ t.get('losses', t.get('l', 0)) }}</td>
    <td class="num">{{ t.get('goals_for', t.get('gf', t.get('pf', 0))) }}</td>
    <td class="num">{{ t.get('goals_against', t.get('ga', t.get('pa', 0))) }}</td>
    <td class="num" style="font-weight:bold">{{ t.get('points', t.get('pts', 0)) }}</td>
  </tr>
  {% endfor %}
  </tbody>
</table>
</div>
{% endfor %}
</div>
{% endif %}

{# ── Knockout ── #}
{% set knockout = wc.get('knockout_rounds', []) %}
{% if knockout %}
<h2>Knockout Stage</h2>
{% for rd in knockout %}
<h3>{{ rd.get('round_name', rd.get('name', 'Round')) }}</h3>
<table>
  <thead><tr><th>Team 1</th><th class="num">Score</th><th></th><th class="num">Score</th><th>Team 2</th><th>Winner</th></tr></thead>
  <tbody>
  {% for m in rd.get('matches', rd.get('matchups', rd.get('games', []))) %}
  {% set wc_home = m.get('home', m.get('home_code', m.get('team1', '?'))) %}
  {% set wc_away = m.get('away', m.get('away_code', m.get('team2', '?'))) %}
  <tr>
    <td><a href="/stats/international/team/{{ wc_home }}">{{ wc_home }}</a></td>
    <td class="num {% if m.get('home_score', 0) > m.get('away_score', 0) %}score-win{% else %}score-loss{% endif %}">
      {% if m.get('match_id') %}<a href="/stats/international/game/{{ m.match_id }}" style="text-decoration:none;color:inherit">{{ m.get('home_score', '?') }}</a>{% else %}{{ m.get('home_score', '?') }}{% endif %}
    </td>
    <td style="color:var(--fg-dim)">v</td>
    <td class="num {% if m.get('away_score', 0) > m.get('home_score', 0) %}score-win{% else %}score-loss{% endif %}">
      {% if m.get('match_id') %}<a href="/stats/international/game/{{ m.match_id }}" style="text-decoration:none;color:inherit">{{ m.get('away_score', '?') }}</a>{% else %}{{ m.get('away_score', '?') }}{% endif %}
    </td>
    <td><a href="/stats/international/team/{{ wc_away }}">{{ wc_away }}</a></td>
    <td>{% if m.get('winner') %}<span class="stat-elite">{{ m.winner }}</span>{% else %}&mdash;{% endif %}</td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% endfor %}
{% endif %}

{# ── All Match Results ── #}
{% set wc_results = wc.get('all_results', []) %}
{% if wc_results %}
<h2>All Results ({{ wc_results|length }} matches)</h2>
<table>
  <thead><tr><th>Home</th><th class="num">Score</th><th></th><th class="num">Score</th><th>Away</th><th>Stage</th></tr></thead>
  <tbody>
  {% for m in wc_results %}
  {% set r_home = m.get('home_code', m.get('home', '?')) %}
  {% set r_away = m.get('away_code', m.get('away', '?')) %}
  <tr>
    <td><a href="/stats/international/team/{{ r_home }}">{{ r_home }}</a></td>
    <td class="num {% if m.get('home_score', 0) > m.get('away_score', 0) %}score-win{% else %}score-loss{% endif %}">
      {% if m.get('match_id') %}<a href="/stats/international/game/{{ m.match_id }}" style="text-decoration:none;color:inherit">{{ m.get('home_score', '?') }}</a>{% else %}{{ m.get('home_score', '?') }}{% endif %}
    </td>
    <td style="color:var(--fg-dim)">v</td>
    <td class="num {% if m.get('away_score', 0) > m.get('home_score', 0) %}score-win{% else %}score-loss{% endif %}">
      {% if m.get('match_id') %}<a href="/stats/international/game/{{ m.match_id }}" style="text-decoration:none;color:inherit">{{ m.get('away_score', '?') }}</a>{% else %}{{ m.get('away_score', '?') }}{% endif %}
    </td>
    <td><a href="/stats/international/team/{{ r_away }}">{{ r_away }}</a></td>
    <td style="color:var(--fg-dim)">{{ m.get('stage', m.get('competition', '')) | replace('_', ' ') | title }}</td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% endif %}

{# ── Tournament Awards ── #}
{% if wc.get('champion') %}
<h2>Tournament Awards</h2>
<div class="grid-3">
  <div class="metric">
    <div class="label">Champion</div>
    <div class="value accent"><a href="/stats/international/team/{{ wc.champion }}" style="color:var(--accent)">{{ wc.champion }}</a></div>
  </div>
  {% if wc.get('golden_boot') %}
  <div class="metric">
    <div class="label">Golden Boot</div>
    <div class="value" style="font-size:13px">{{ wc.golden_boot }}</div>
  </div>
  {% endif %}
  {% if wc.get('mvp') %}
  <div class="metric">
    <div class="label">MVP</div>
    <div class="value" style="font-size:13px">{{ wc.mvp }}</div>
  </div>
  {% endif %}
  {% if wc.get('third_place') %}
  <div class="metric">
    <div class="label">Third Place</div>
    <div class="value" style="font-size:13px">{{ wc.third_place }}</div>
  </div>
  {% endif %}
</div>
{% endif %}

{% else %}
<div class="empty">World Cup has not started yet. Run continental championships and qualification first.</div>
{% endif %}
{% endblock %}
