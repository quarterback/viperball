{% extends "base.html" %}
{% block title %}Team Stats — {{ season_name }} — Viperball Stats{% endblock %}

{% block breadcrumb %}
<div class="breadcrumb"><div class="container wide">
  <a href="/stats/">Home</a><span class="sep">/</span><a href="/stats/college/">College</a><span class="sep">/</span><a href="/stats/college/{{ session_id }}/">{{ season_name }}</a><span class="sep">/</span>Team Stats
</div></div>
{% endblock %}

{% block content %}
<div class="page-header">
  <h1>TEAM STATS</h1>
  <div class="subtitle">{{ season_name }}{% if conference %} &middot; {{ conference }}{% endif %}</div>
</div>

<div class="tabs">
  <a href="/stats/college/{{ session_id }}/">Overview</a>
  <a href="/stats/college/{{ session_id }}/standings">Standings</a>
  <a href="/stats/college/{{ session_id }}/schedule">Schedule</a>
  <a href="/stats/college/{{ session_id }}/polls">Polls</a>
  <a href="/stats/college/{{ session_id }}/players">Players</a>
  <a href="/stats/college/{{ session_id }}/team-stats" class="active">Team Stats</a>
  <a href="/stats/college/{{ session_id }}/awards">Awards</a>
</div>

{# Conference filter #}
{% if conferences %}
<div style="margin-bottom:12px; font-size:11px;">
  <strong>Conference:</strong>
  <a href="/stats/college/{{ session_id }}/team-stats?sort={{ sort }}" {% if not conference %}style="color:var(--accent);font-weight:bold"{% endif %}>All</a>
  {% for c in conferences %}
  &middot; <a href="/stats/college/{{ session_id }}/team-stats?sort={{ sort }}&conference={{ c }}" {% if conference == c %}style="color:var(--accent);font-weight:bold"{% endif %}>{{ c[:20] }}</a>
  {% endfor %}
</div>
{% endif %}

{# Sort selector #}
<div style="margin-bottom:16px; font-size:11px;">
  <strong>Sort by:</strong>
  {% for label, key in [
    ('Total Yards', 'total_yards'), ('Avg Yards', 'avg_yards'), ('YPP', 'yards_per_play'),
    ('TDs', 'touchdowns'), ('Rushing', 'rushing_yards'), ('Kick-Pass', 'kp_yards'),
    ('Laterals', 'lateral_yards'), ('EPA', 'epa'), ('EPA/G', 'avg_epa'),
    ('Rating', 'avg_team_rating'), ('Viper Eff', 'avg_viper_eff'),
    ('Delta Yds', 'delta_yards'), ('Bonus Poss', 'bonus_possessions'),
    ('Fumbles', 'fumbles'), ('Penalties', 'penalties'),
  ] %}
  {% if not loop.first %}&middot; {% endif %}
  <a href="/stats/college/{{ session_id }}/team-stats?sort={{ key }}{% if conference %}&conference={{ conference }}{% endif %}" {% if sort == key %}style="color:var(--accent);font-weight:bold"{% endif %}>{{ label }}</a>
  {% endfor %}
</div>

{% if teams %}
<div style="overflow-x:auto;">
<table>
  <thead>
    <tr>
      <th class="num">#</th>
      <th>Team</th>
      <th>Conf</th>
      <th>W-L</th>
      <th class="num">GP</th>
      <th class="num">YDS</th>
      <th class="num">Y/G</th>
      <th class="num">YPP</th>
      <th class="num">TD</th>
      <th class="num">RUSH</th>
      <th class="num">KP</th>
      <th class="num">KP%</th>
      <th class="num">LAT</th>
      <th class="num">EPA</th>
      <th class="num">E/G</th>
      <th class="num">RTG</th>
      <th class="num">VE</th>
      <th class="num">&Delta;Y</th>
      <th class="num">FUM</th>
      <th class="num">PEN</th>
    </tr>
  </thead>
  <tbody>
  {% for t in teams %}
  <tr>
    <td class="num rank">{{ loop.index }}</td>
    <td><a href="/stats/college/{{ session_id }}/team/{{ t.team }}">{{ t.team }}</a></td>
    <td style="font-size:10px;">{{ t.conference[:12] }}</td>
    <td class="record"><span class="w">{{ t.wins }}</span>-<span class="l">{{ t.losses }}</span></td>
    <td class="num">{{ t.games }}</td>
    <td class="num {% if sort == 'total_yards' %}stat-good{% endif %}">{{ t.total_yards }}</td>
    <td class="num {% if sort == 'avg_yards' %}stat-good{% endif %}">{{ t.avg_yards }}</td>
    <td class="num {% if sort == 'yards_per_play' %}stat-good{% endif %}">{{ t.yards_per_play }}</td>
    <td class="num {% if sort == 'touchdowns' %}stat-good{% endif %}">{{ t.touchdowns }}</td>
    <td class="num {% if sort == 'rushing_yards' %}stat-good{% endif %}">{{ t.rushing_yards }}</td>
    <td class="num {% if sort == 'kp_yards' %}stat-good{% endif %}">{{ t.kp_yards }}</td>
    <td class="num">{{ t.kp_comp_pct }}%</td>
    <td class="num {% if sort == 'lateral_yards' %}stat-good{% endif %}">{{ t.lateral_yards }}</td>
    <td class="num {% if sort == 'epa' %}stat-good{% elif t.epa < 0 %}stat-bad{% endif %}">{{ '%.1f'|format(t.epa) }}</td>
    <td class="num {% if sort == 'avg_epa' %}stat-good{% elif t.avg_epa < 0 %}stat-bad{% endif %}">{{ t.avg_epa }}</td>
    <td class="num {% if sort == 'avg_team_rating' %}stat-good{% elif t.avg_team_rating >= 70 %}stat-elite{% elif t.avg_team_rating >= 55 %}stat-good{% endif %}">{{ t.avg_team_rating }}</td>
    <td class="num {% if sort == 'avg_viper_eff' %}stat-good{% endif %}">{{ t.avg_viper_eff }}</td>
    <td class="num {% if sort == 'delta_yards' %}stat-good{% elif t.delta_yards > 0 %}stat-good{% elif t.delta_yards < 0 %}stat-bad{% endif %}">{{ t.delta_yards }}</td>
    <td class="num {% if sort == 'fumbles' %}stat-good{% elif t.fumbles >= 5 %}stat-bad{% endif %}">{{ t.fumbles }}</td>
    <td class="num {% if sort == 'penalties' %}stat-good{% elif t.penalties >= 20 %}stat-bad{% endif %}">{{ t.penalties }}</td>
  </tr>
  {% endfor %}
  </tbody>
</table>
</div>
{% else %}
<p class="empty">No team stats available yet. Games need to be played first.</p>
{% endif %}

{% endblock %}
